webpackJsonp([33],{"+p4l":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("Js1K"),a={name:"userRolesEdit",props:["id","vipid"],data:function(){var e=this;return{list:[],ruleForm:{form_token:"",id:"",user_vips_id:"",preferential_quota:"",price_start:"0",price_end:""},rules:{user_vips_id:[{required:!0,message:this.$t("user_role.user_vips_id_no"),trigger:"change"}],preferential_quota:[{required:!0,message:this.$t("user_role.preferential_quota_no"),trigger:"blur|change"}],price_start:[{validator:function(t,i,r){if(""===i)return r(new Error(e.$t("user_role.price_start_no")));r()},trigger:"blur|change"}],price_end:[{validator:function(t,i,r){if(""===i)return r(new Error(e.$t("user_role.price_end_no")));if(0==i)r();else{if(i<e.ruleForm.price_start)return r(new Error(e.$t("user_role.price_end_not")));r()}},trigger:"blur|change"}]}}},computed:{},created:function(){this.getUserRoleList(),this.getformtoken(),this.id&&this.getInfo()},methods:{getUserRoleList:function(){var e=this;e.$request.getUserRoleList().then(function(t){if(1==t.code){if(t.data){for(var i in t.data)"ch"==e.$i18n.locale?t.data[i].name=t.data[i].title_zh:t.data[i].name=t.data[i].title,t.data[i].id=Number(t.data[i].id);e.list=t.data}e.ruleForm.user_vips_id=Number(e.vipid)}})},getInfo:function(){var e=this;e.$request.getVipsdiscountInfo({id:e.id}).then(function(t){if(t.data)for(var i in t.data)for(var r in e.ruleForm)i==r&&(e.ruleForm[r]=t.data[i]);console.log(e.ruleForm)}).catch(function(e){})},getformtoken:function(){var e=this;e.$request.getformtoken().then(function(t){e.ruleForm.form_token=t.data.token})},submitForm:function(e){var t=this,i=this;i.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;i.$request.setVipsdiscountSave(i.ruleForm).then(function(e){1==e.code?(i.$emit("changeQuotaDialog",i.ruleForm),t.$notify({title:i.$t("config.tips"),message:e.msg,type:"success",duration:"2000"})):i.getformtoken()})})}}},o={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"rule_edit",staticStyle:{"padding-top":"30px"}},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"150px"}},[i("el-form-item",{attrs:{label:"Vip Level",prop:"user_vips_id"}},[i("el-select",{attrs:{placeholder:e.$t("config.select")},model:{value:e.ruleForm.user_vips_id,callback:function(t){e.$set(e.ruleForm,"user_vips_id",t)},expression:"ruleForm.user_vips_id"}},e._l(e.list,function(t,r){return e.list?i("el-option",{key:t.id,attrs:{label:t.name,value:t.id}}):e._e()}),1)],1),e._v(" "),i("el-form-item",{attrs:{label:e.$t("user_role.preferential_quota"),prop:"preferential_quota"}},[i("el-input",{model:{value:e.ruleForm.preferential_quota,callback:function(t){e.$set(e.ruleForm,"preferential_quota",t)},expression:"ruleForm.preferential_quota"}},[i("template",{slot:"append"},[e._v("%")])],2)],1),e._v(" "),i("el-form-item",{attrs:{label:e.$t("user_role.price_start"),prop:"price_start"}},[i("el-input",{model:{value:e.ruleForm.price_start,callback:function(t){e.$set(e.ruleForm,"price_start",t)},expression:"ruleForm.price_start"}},[i("template",{slot:"append"},[e._v("$")])],2)],1),e._v(" "),i("el-form-item",{attrs:{label:e.$t("user_role.price_end"),prop:"price_end"}},[i("el-input",{model:{value:e.ruleForm.price_end,callback:function(t){e.$set(e.ruleForm,"price_end",t)},expression:"ruleForm.price_end"}},[i("template",{slot:"append"},[e._v("$")])],2)],1),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(e._s(e.$t("config.submit")))])],1)],1)],1)},staticRenderFns:[]};var n=i("VU/8")(a,o,!1,function(e){i("zGX+")},"data-v-0eaa1148",null).exports,l={components:{layoutPage:r.a,quotaEdit:n},data:function(){return{dialogTableVisible:!1,vipid:"",search:{page:1,user_vips_id:"1"},id:null,total:0,vip_list:[],tableheight:"100%",tableData:[],dialogTableTitle:"Info"}},computed:{rank:function(){return this.$store.state.rank}},created:function(){var e=this.$route.query;this.search.user_vips_id=e.id,this.vipid=e.id,this.getList()},methods:{refresh:function(){this.getList()},pageRouter:function(e){this.search.page=e,this.getList()},getList:function(){var e=this;e.$request.getVipsdiscountList(e.search).then(function(t){t.data.forEach(function(e){e.preferential_quota=e.preferential_quota+"%",e.price_start&&""!=e.price_start||(e.price_start="0.00"),e.price_start=e.price_start+"$",e.price_end&&""!=e.price_end||(e.price_end="0.00"),e.price_end=e.price_end+"$"}),e.tableData=t.data,e.total=t.data.page?t.data.page:null,e.tableheight=window.innerHeight-221,t.data.page>1&&(e.tableheight=window.innerHeight-281)})},addRow:function(){this.dialogTableTitle="Add",this.id="",this.dialogTableVisible=!0},EditRow:function(e){this.dialogTableTitle="Edit",this.dialogTableVisible=!0,this.id=e.id},changeQuotaDialog:function(e){this.dialogTableTitle="",this.id="",this.dialogTableVisible=!1,this.getList()},deleteRow:function(e){var t=this,i=this;i.$alert(i.$t("config.delMsg"),i.$t("config.tips"),{confirmButtonText:i.$t("config.confirm"),showCancelButton:!0,cancelButtonText:i.$t("config.cancel")}).then(function(){i.$request.delVipsdiscount({id:e.id}).then(function(e){1==e.code&&(i.getUserList(),t.$notify({title:i.$t("config.tips"),message:e.msg,type:"success"}))})})}}},s={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"group",staticStyle:{background:"white",padding:"15px","border-radius":"5px"}},[i("div",{staticClass:"toolbar"},[i("div",{staticClass:"toolbar_left"},[i("el-button",{staticClass:"d-button",attrs:{type:"success",icon:"el-icon-d-arrow-left"},on:{click:function(t){return e.$router.go(-1)}}}),e._v(" "),i("el-button",{staticClass:"d-refresh-button",attrs:{icon:"el-icon-refresh"},on:{click:function(t){return e.refresh()}}}),e._v(" "),e.rank&&e.rank.add?i("el-button",{staticClass:"d-buttom",attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.addRow}},[e._v(e._s(e.$t("config.add")))]):e._e()],1)]),e._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",splict:""}},[i("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:"60"}}),e._v(" "),i("el-table-column",{attrs:{prop:"preferential_quota","min-width":"400",label:e.$t("user_role.preferential_quota")}}),e._v(" "),i("el-table-column",{attrs:{prop:"price_start","min-width":"400",label:e.$t("user_role.price_start")}}),e._v(" "),i("el-table-column",{attrs:{prop:"price_end","min-width":"300",label:e.$t("user_role.price_end")}}),e._v(" "),i("el-table-column",{attrs:{fixed:"right",label:e.$t("config.operate"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.rank&&e.rank.edit?i("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(i){return i.preventDefault(),e.EditRow(t.row)}}},[e._v("\n            "+e._s(e.$t("config.edit"))+"\n          ")]):e._e(),e._v(" "),e.rank&&e.rank.del?i("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(i){return i.preventDefault(),e.deleteRow(t.row)}}},[e._v("\n            "+e._s(e.$t("config.del"))+"\n          ")]):e._e()]}}])})],1),e._v(" "),e.total&&e.total>1?i("layoutPage",{attrs:{page:e.search.page,num:"5",total:e.total},on:{pageRouter:e.pageRouter}}):e._e(),e._v(" "),e.dialogTableVisible?i("el-dialog",{attrs:{visible:e.dialogTableVisible,width:"500px",title:e.dialogTableTitle},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[i("quotaEdit",{attrs:{id:e.id,vipid:e.vipid},on:{changeQuotaDialog:e.changeQuotaDialog}})],1):e._e()],1)},staticRenderFns:[]};var u=i("VU/8")(l,s,!1,function(e){i("ANHa")},"data-v-2b4524b8",null);t.default=u.exports},ANHa:function(e,t){},"zGX+":function(e,t){}});