webpackJsonp([18],{LZye:function(e,t){},Q9Gn:function(e,t){},WDrI:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l("Js1K"),n={name:"ruleEdit",props:["roleId"],data:function(){return{lang:this.$i18n.locale,ruleTree:{all:!1,open:!1,list:[]},defaultProps:{children:"children",label:"label"},ruleForm:{id:"",title:"",title_zh:"",status:"1",rule_ids:"",form_token:""},rules:{title:[{required:!0,message:this.$t("config.title_no"),trigger:"blur|change"}],title_zh:[{required:!0,message:this.$t("config.title_zh_no"),trigger:"blur|change"}]}}},created:function(){this.roleId?this.getRoleInfo():this.getRuleList(""),this.getformtoken()},methods:{getRuleList:function(e){var t=this;t.$request.getRulesList({type:"role"}).then(function(l){1==l.code&&(t.setTree(l.data,e),t.ruleTree.list=l.data)})},setTree:function(e,t){var l=this,i=t.split(",");e.forEach(function(e){1==e.status&&(e.show=!1,i.indexOf(String(e.id))>=0?e.checked=!0:e.checked=!1,e.node&&e.node.length>0?(e.nodeThree=!0,l.setTree(e.node,t)):e.nodeThree=!1)})},getRoleInfo:function(){var e=this;e.$request.getRolesInfo({id:e.roleId}).then(function(t){if(1==t.code)for(var l in e.getRuleList(t.data.rule_ids),t.data)for(var i in e.ruleForm)l==i&&("status"==l&&(t.data[l]=String(t.data[l])),e.ruleForm[i]=t.data[l])})},getformtoken:function(){var e=this;e.$request.getformtoken().then(function(t){e.ruleForm.form_token=t.data.token})},bindShow:function(e){e.show=!e.show},changeTree:function(e){parent&&this.treeParent(e.pid),this.treeEach(e),this.ruleForm.rule_ids=this.getCheckedTreeALL(this.ruleTree.list,[]).join(",")},treeParent:function(e){this.getParent(this.ruleTree.list,e)},getParent:function(e,t){var l=this;e.forEach(function(e){e.id!=t?e.node&&e.node.length>0&&l.getParent(e.node,t):(l.getTreeNum(e.node)>0?e.checked=!0:e.checked=!1,l.getParent(l.ruleTree.list,e.pid))})},getTreeNum:function(e){var t=0;for(var l in e)e[l].checked&&t++;return t},treeEach:function(e){if(e.node)for(var t in e.node)e.node[t].checked=e.checked,this.treeEach(e.node[t])},bindTreeAll:function(){this.setTreechange(this.ruleTree.list,"all"),this.ruleForm.rule_ids=this.getCheckedTreeALL(this.ruleTree.list,[]).join(",")},bindTreeOpen:function(){this.setTreechange(this.ruleTree.list,"open")},setTreechange:function(e,t){var l=this;e.forEach(function(e){"all"==t?e.checked=l.ruleTree.all:e.show=l.ruleTree.open,e.node&&e.node.length>0&&l.setTreechange(e.node,t)})},getCheckedTreeALL:function(e,t){var l=this;return e.forEach(function(e){e.checked&&t.push(e.id),e.node&&e.node.length>0&&l.getCheckedTreeALL(e.node,t)}),t},submitForm:function(e){var t=this,l=this;l.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;l.$request.setRolesSave(l.ruleForm).then(function(e){1==e.code?(l.$emit("changeRolesDialog",l.ruleForm),t.$notify({title:l.$t("config.tips"),message:e.msg,type:"success",duration:"2000"})):l.getformtoken()})})}}},r={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"rule_edit",staticStyle:{"padding-top":"30px","background-color":"white"}},[l("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[l("el-form-item",{attrs:{label:e.$t("config.title"),prop:"title"}},[l("el-input",{model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),l("el-form-item",{attrs:{label:e.$t("config.title_zh"),prop:"title"}},[l("el-input",{model:{value:e.ruleForm.title_zh,callback:function(t){e.$set(e.ruleForm,"title_zh",t)},expression:"ruleForm.title_zh"}})],1),e._v(" "),l("el-form-item",{attrs:{label:e.$t("config.status")}},[l("el-radio",{attrs:{label:"1"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[e._v(e._s(e.$t("config.start_using")))]),e._v(" "),l("el-radio",{attrs:{label:"2"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[e._v(e._s(e.$t("config.deactivate")))])],1),e._v(" "),l("el-form-item",{staticClass:"rule_ids",attrs:{label:e.$t("roles.rule"),prop:"rule_ids"}},[l("div",{staticClass:"el-role-tree"},[l("div",{staticClass:"el-role-tree-all el-tree-flex"},[l("div",{staticClass:"el-tree-item"},[l("el-checkbox",{on:{change:e.bindTreeAll},model:{value:e.ruleTree.all,callback:function(t){e.$set(e.ruleTree,"all",t)},expression:"ruleTree.all"}},[e._v("全选")])],1),e._v(" "),l("div",{staticClass:"el-tree-item"},[l("el-checkbox",{on:{change:e.bindTreeOpen},model:{value:e.ruleTree.open,callback:function(t){e.$set(e.ruleTree,"open",t)},expression:"ruleTree.open"}},[e._v("展开")])],1)]),e._v(" "),l("div",{staticClass:"el-tree-body"},[e.ruleTree.list&&e.ruleTree.list.length>0?l("div",{staticClass:"el-tree-ul"},e._l(e.ruleTree.list,function(t,i){return l("div",{key:i,staticClass:"el-tree-li"},[l("i",{class:t.show?"el-icon-caret-bottom":"el-icon-caret-right",on:{click:function(l){return e.bindShow(t)}}}),e._v(" "),l("div",{staticClass:"el-tree-item"},[l("el-checkbox",{attrs:{indeterminate:t.indeterminate},on:{change:function(l){return e.changeTree(t)}},model:{value:t.checked,callback:function(l){e.$set(t,"checked",l)},expression:"item.checked"}},[e._v(e._s("ch"==e.lang?t.title_zh:t.title))])],1),e._v(" "),t.show?l("div",{staticClass:"el-tree-ul"},[t.nodeThree?e._l(t.node,function(i,n){return l("div",{key:n,staticClass:"el-tree-li ",class:i.node&&i.node.length>0?"":"el-tree-flex"},[l("i",{class:i.show?"el-icon-caret-bottom":"el-icon-caret-right",on:{click:function(t){return e.bindShow(i)}}}),e._v(" "),l("div",{staticClass:"el-tree-item"},[l("el-checkbox",{attrs:{indeterminate:t.indeterminate},on:{change:function(t){return e.changeTree(i)}},model:{value:i.checked,callback:function(t){e.$set(i,"checked",t)},expression:"items.checked"}},[e._v(e._s("ch"==e.lang?i.title_zh:i.title))])],1),e._v(" "),i.show&&i.node&&i.node.length>0?l("div",{staticClass:"el-tree-flex"},e._l(i.node,function(t,i){return l("div",{key:i,staticClass:"el-tree-item"},[l("el-checkbox",{on:{change:function(l){return e.changeTree(t)}},model:{value:t.checked,callback:function(l){e.$set(t,"checked",l)},expression:"key.checked"}},[e._v(e._s("ch"==e.lang?t.title_zh:t.title))])],1)}),0):e._e()])}):l("div",{staticClass:"el-tree-flex"},e._l(t.node,function(t,i){return l("div",{key:i,staticClass:"el-tree-item"},[l("el-checkbox",{on:{change:function(l){return e.changeTree(t)}},model:{value:t.checked,callback:function(l){e.$set(t,"checked",l)},expression:"items.checked"}},[e._v(e._s("ch"==e.lang?t.title_zh:t.title))])],1)}),0)],2):e._e()])}),0):e._e()])])]),e._v(" "),l("el-form-item",[l("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(e._s(e.$t("config.submit")))])],1)],1)],1)},staticRenderFns:[]};var o=l("VU/8")(n,r,!1,function(e){l("LZye")},"data-v-6c8d6c4f",null).exports,s={components:{layoutPage:i.a,rolesEdit:o},data:function(){return{loadingTable:!0,dialogTableVisible:!1,roleId:null,tableData:[],dialogTableTitle:"Info"}},computed:{rank:function(){return this.$store.state.rank}},created:function(){this.getList()},methods:{refresh:function(){this.getList()},getList:function(){var e=this;e.loadingTable=!0,e.$request.getRolesList(e.search).then(function(t){e.loadingTable=!1,e.tableData=t.data})},addRow:function(){this.dialogTableTitle="Add Role",this.dialogTableVisible=!0,this.roleId=""},EditRow:function(e){this.dialogTableTitle="Edit Role",this.dialogTableVisible=!0,this.roleId=e.id},deleteRow:function(e){var t=this,l=this;l.$alert(l.$t("config.delMsg"),l.$t("config.tips"),{confirmButtonText:l.$t("config.confirm"),showCancelButton:!0,cancelButtonText:l.$t("config.cancel")}).then(function(){l.$request.delRoles({id:e.id}).then(function(e){l.getRolesList(),t.$notify({title:l.$t("config.tips"),message:e.data.msg,type:"success"})})})},changeRolesDialog:function(e){this.dialogTableVisible=!1,this.getRolesList()}}},a={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"group",staticStyle:{"background-color":"white",padding:"15px","border-radius":"5px"}},[l("div",{staticClass:"toolbar"},[l("div",{staticClass:"toolbar_left"},[l("el-button",{staticClass:"d-refresh-button",attrs:{icon:"el-icon-refresh"},on:{click:function(t){return e.refresh()}}}),e._v(" "),e.rank&&e.rank.add?l("el-button",{staticClass:"d-button",attrs:{type:"success",icon:"el-icon-plus"},on:{click:e.addRow}},[e._v(e._s(e.$t("config.add")))]):e._e()],1)]),e._v(" "),l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingTable,expression:"loadingTable"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",splict:""}},[l("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:"60"}}),e._v(" "),l("el-table-column",{attrs:{prop:"title","min-width":"200",label:e.$t("config.title")}}),e._v(" "),l("el-table-column",{attrs:{prop:"title_zh","min-width":"200",label:e.$t("config.title_zh")}}),e._v(" "),l("el-table-column",{attrs:{prop:"status",label:e.$t("config.status"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-tag",{attrs:{type:1==t.row.status?"primary":"success","disable-transitions":""}},[e._v(e._s(1==t.row.status?e.$t("config.start_using"):e.$t("config.deactivate")))])]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"created_at",label:e.$t("config.create_at"),width:"300"}}),e._v(" "),l("el-table-column",{attrs:{fixed:"right",label:e.$t("config.operate"),width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.rank&&e.rank.edit?l("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(l){return l.preventDefault(),e.EditRow(t.row)}}},[e._v("\n            "+e._s(e.$t("config.edit"))+"\n          ")]):e._e(),e._v(" "),e.rank&&e.rank.del?l("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(l){return l.preventDefault(),e.deleteRow(t.row)}}},[e._v("\n            "+e._s(e.$t("config.del"))+"\n          ")]):e._e()]}}])})],1),e._v(" "),e.dialogTableVisible?l("el-dialog",{attrs:{visible:e.dialogTableVisible,width:"800px",title:e.dialogTableTitle},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[l("rolesEdit",{attrs:{roleId:e.roleId},on:{changeRolesDialog:e.changeRolesDialog}})],1):e._e()],1)},staticRenderFns:[]};var c=l("VU/8")(s,a,!1,function(e){l("Q9Gn")},"data-v-bdc23e02",null);t.default=c.exports}});